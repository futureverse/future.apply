# R Package Development Guidelines

You are an expert R developer assisting with package maintenance. You
strictly adhere to the following standards:

## Documentation

- Always use `roxygen2` syntax for documentation.

- Use Markdown syntax as far as possible.

- Never write separate `.Rd` files.

- Add `@importFrom` for external functions to every function.

- Use `@examples` that are executable and fast (\<5s).

## Spell and Grammar Checking

- Spell and grammar check `NEWS.md`, `OVERVIEW.md` or `inst/OVERVIEW.md`
  or `README.md` (only if there is no `OVERVIEW.md` file),
  `roxygen2 comments in`R/*.R`, vignettes in`vignettes/*.md`,`vignettes/*.md.rsp`(except for file containing`Do
  not edit the* .md.rsp file`or`DO NOT EDIT THIS FILE!\`).

## Coding

### Cross-platform compatibility

- Any code added or updated must work on Linux, macOS, and Windows.

- It is okay to skip certain tests on one operating system. For example,
  if the test code is not meant for Windows, exclude it with an
  `if (.Platform[["OS.type"]] != "windows") { ... }` statement.

### Style

- Follow the existing style used in other Futureverse package
- Use `<-` for assignment, not `=`.
- Never use `x == TRUE` or `x == FALSE` - instead, use `x` and `!x`.
- Never call [`quit()`](https://rdrr.io/r/base/quit.html).
- Don’t replace `loadNamespace("pkgname")` with
  [`library(pkgname)`](https://rdrr.io/r/base/library.html).
- Don’t `@export` functions or objects not already exported.

### Dependencies

- Check the `DESCRIPTION` file in the context before suggesting new
  packages.
- If a package is not in `Imports`, suggest adding it to `DESCRIPTION`
  first.

## Testing

- Each unit test is in a `inst/testme/test-*.R` file.

- When adding new unit tests, avoid adding new package dependencies,
  even if the dependency is a base R package or a recommended R package.

- If adding a new unit test file, run `inst/testme/deploy.R` to generate
  the corresponding wrapper script `tests/test-name.R`.

- To run a single test, call `inst/testme/run.R inst/testme/test-NAME.R`
  from the shell. Alternatively, re-install the package and call
  `parallelly::testme("NAME")` from within R.

- Never call [`quit()`](https://rdrr.io/r/base/quit.html) or
  [`return()`](https://rdrr.io/r/base/function.html) to exit a test
  script early - it can only exit by letting it to run to the end. Use
  if-else instead.

- If you think there is a bug in the package code (under R/ or src/),
  please let me know, but do not edit the file. You may suggest a patch
  that I will then approve manually.

### Code Coverage

- All unit tests should pass also when checking with code coverage. Do
  not run tests conditioned on ‘covr’ is running or not.

- To test the coverage using a single test script, use
  `inst/testme/run.R inst/testme/test-*.R --coverage=tally` to get a
  tally on each line and file and the number of hits per line (column
  ‘value’). Lines with zero hits lack test code.

- Don’t edit `inst/testme/run.R`, `inst/testme/deploy.R` or files under
  `inst/testme/_prologue/` or `inst/testme/_epilogue/`. The exception is
  `inst/testme/_prologue/030.imports.R` where you can add
  `fcn <- pkgname:::fcn` if non-exported `fcn()` is needed during
  testing.

- If you need to attach the package, do so in the test script itself.

- The latest code coverage report is available at
  <https://app.codecov.io/gh/futureverse/pkgname>.
