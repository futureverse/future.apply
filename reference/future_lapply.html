<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Apply a Function over a List or Vector via Futures — future_eapply • future.apply</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Apply a Function over a List or Vector via Futures — future_eapply"><meta name="description" content="future_lapply() implements base::lapply() using futures with perfect
replication of results, regardless of future backend used.
Analogously, this is true for all the other future_nnn() functions."><meta property="og:description" content="future_lapply() implements base::lapply() using futures with perfect
replication of results, regardless of future backend used.
Analogously, this is true for all the other future_nnn() functions."><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-SB3EQSD9FR"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SB3EQSD9FR');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">future.apply</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.11.3-9008</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/future.apply-1-overview.html">A Future for R: Apply Function to Elements in Parallel</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://www.futureverse.org/"><span class="fa fas fa-home"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Packages</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-packages"><li><a class="external-link dropdown-item" href="https://doFuture.futureverse.org">doFuture (map-reduce)</a></li>
    <li><a class="external-link dropdown-item" href="https://furrr.futureverse.org">furrr (map-reduce)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.futureverse.org">future</a></li>
    <li><a class="dropdown-item" href="https://future.apply.futureverse.org">future.apply (map-reduce)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.batchtools.futureverse.org">future.batchtools (backend)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.callr.futureverse.org">future.callr (backend)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.mirai.futureverse.org">future.mirai (backend)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.tests.futureverse.org">future.tests</a></li>
    <li><a class="external-link dropdown-item" href="https://globals.futureverse.org">globals</a></li>
    <li><a class="external-link dropdown-item" href="https://listenv.futureverse.org">listenv</a></li>
    <li><a class="external-link dropdown-item" href="https://parallelly.futureverse.org">parallelly</a></li>
    <li><a class="external-link dropdown-item" href="https://progressr.futureverse.org">progressr</a></li>
    <li><a class="external-link dropdown-item" href="https://BiocParallel.FutureParam.futureverse.org">BiocParallel.FutureParam (experimental)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.tools.futureverse.org">future.tools (experimental)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.mapreduce.futureverse.org">future.mapreduce (experimental)</a></li>
    <li><a class="external-link dropdown-item" href="https://marshal.futureverse.org">marshal (experimental)</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://cloud.r-project.org/package=future.apply"><span class="fa fab fa-r-project"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/futureverse/future.apply/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Apply a Function over a List or Vector via Futures</h1>
      <small class="dont-index">Source: <a href="https://github.com/futureverse/future.apply/blob/HEAD/R/future_eapply.R" class="external-link"><code>R/future_eapply.R</code></a>, <a href="https://github.com/futureverse/future.apply/blob/HEAD/R/future_lapply.R" class="external-link"><code>R/future_lapply.R</code></a>, <a href="https://github.com/futureverse/future.apply/blob/HEAD/R/future_replicate.R" class="external-link"><code>R/future_replicate.R</code></a>, and 3 more</small>
      <div class="d-none name"><code>future_lapply.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>future_lapply()</code> implements <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">base::lapply()</a></code> using futures with perfect
replication of results, regardless of future backend used.
Analogously, this is true for all the other <code>future_nnn()</code> functions.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">future_eapply</span><span class="op">(</span></span>
<span>  <span class="va">env</span>,</span>
<span>  <span class="va">FUN</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  all.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  USE.NAMES <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  future.envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  future.label <span class="op">=</span> <span class="st">"future_eapply-%d"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">future_lapply</span><span class="op">(</span></span>
<span>  <span class="va">X</span>,</span>
<span>  <span class="va">FUN</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  future.envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  future.stdout <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  future.conditions <span class="op">=</span> <span class="st">"condition"</span>,</span>
<span>  future.globals <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  future.packages <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  future.seed <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  future.scheduling <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  future.chunk.size <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  future.label <span class="op">=</span> <span class="st">"future_lapply-%d"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">future_replicate</span><span class="op">(</span></span>
<span>  <span class="va">n</span>,</span>
<span>  <span class="va">expr</span>,</span>
<span>  simplify <span class="op">=</span> <span class="st">"array"</span>,</span>
<span>  future.seed <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  future.envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  future.label <span class="op">=</span> <span class="st">"future_replicate-%d"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">future_sapply</span><span class="op">(</span></span>
<span>  <span class="va">X</span>,</span>
<span>  <span class="va">FUN</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  simplify <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  USE.NAMES <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  future.envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  future.label <span class="op">=</span> <span class="st">"future_sapply-%d"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">future_tapply</span><span class="op">(</span></span>
<span>  <span class="va">X</span>,</span>
<span>  <span class="va">INDEX</span>,</span>
<span>  FUN <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  default <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  simplify <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  future.envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  future.label <span class="op">=</span> <span class="st">"future_tapply-%d"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">future_vapply</span><span class="op">(</span></span>
<span>  <span class="va">X</span>,</span>
<span>  <span class="va">FUN</span>,</span>
<span>  <span class="va">FUN.VALUE</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  USE.NAMES <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  future.envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  future.label <span class="op">=</span> <span class="st">"future_vapply-%d"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-env">env<a class="anchor" aria-label="anchor" href="#arg-env"></a></dt>
<dd><p>An <span style="R">R</span> environment.</p></dd>


<dt id="arg-fun">FUN<a class="anchor" aria-label="anchor" href="#arg-fun"></a></dt>
<dd><p>A function taking at least one argument.</p></dd>


<dt id="arg-all-names">all.names<a class="anchor" aria-label="anchor" href="#arg-all-names"></a></dt>
<dd><p>If <code>TRUE</code>, the function will also be applied to variables
that start with a period (<code>.</code>), otherwise not.
See <code><a href="https://rdrr.io/r/base/eapply.html" class="external-link">base::eapply()</a></code> for details.</p></dd>


<dt id="arg-use-names">USE.NAMES<a class="anchor" aria-label="anchor" href="#arg-use-names"></a></dt>
<dd><p>See <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">base::sapply()</a></code>.</p></dd>


<dt id="arg-future-envir">future.envir<a class="anchor" aria-label="anchor" href="#arg-future-envir"></a></dt>
<dd><p>An <a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a> passed as argument <code>envir</code> to
<code><a href="https://future.futureverse.org/reference/future.html" class="external-link">future::future()</a></code> as-is.</p></dd>


<dt id="arg-future-label">future.label<a class="anchor" aria-label="anchor" href="#arg-future-label"></a></dt>
<dd><p>If a character string, then each future is assigned
a label <code>sprintf(future.label, chunk_idx)</code>.  If TRUE, then the
same as <code>future.label = "future_lapply-%d"</code>.  If FALSE, no labels
are assigned.</p></dd>


<dt id="arg-x">X<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>An <span style="R">R</span> object for which a <code><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></code> method
exists.  Typically vector-like, allowing subsetting with
<code><a href="https://rdrr.io/r/base/Extract.html" class="external-link">[</a></code>, or a data frame.</p></dd>


<dt id="arg-future-stdout">future.stdout<a class="anchor" aria-label="anchor" href="#arg-future-stdout"></a></dt>
<dd><p>If <code>TRUE</code> (default), then the standard output of the
underlying futures is captured, and re-outputted as soon as possible.
If <code>FALSE</code>, any output is silenced (by sinking it to the null device
as it is outputted).
If <code>NA</code> (not recommended), output is <em>not</em> intercepted.</p></dd>


<dt id="arg-future-conditions">future.conditions<a class="anchor" aria-label="anchor" href="#arg-future-conditions"></a></dt>
<dd><p>A character string of conditions classes to be
captured and relayed.  The default is the same as the <code>condition</code>
argument of <code><a href="https://future.futureverse.org/reference/Future-class.html" class="external-link">future::Future()</a></code>.
To not intercept conditions, use <code>conditions = character(0L)</code>.
Errors are always relayed.</p></dd>


<dt id="arg-future-globals">future.globals<a class="anchor" aria-label="anchor" href="#arg-future-globals"></a></dt>
<dd><p>A logical, a character vector, or a named list for
controlling how globals are handled. For details, see below section.</p></dd>


<dt id="arg-future-packages">future.packages<a class="anchor" aria-label="anchor" href="#arg-future-packages"></a></dt>
<dd><p>(optional) a character vector specifying packages
to be attached in the R environment evaluating the future.</p></dd>


<dt id="arg-future-seed">future.seed<a class="anchor" aria-label="anchor" href="#arg-future-seed"></a></dt>
<dd><p>A logical or an integer (of length one or seven),
or a list of <code>length(X)</code> with pre-generated random seeds.
For details, see below section.</p></dd>


<dt id="arg-future-scheduling">future.scheduling<a class="anchor" aria-label="anchor" href="#arg-future-scheduling"></a></dt>
<dd><p>Average number of futures ("chunks") per worker.
If <code>0.0</code>, then a single future is used to process all elements
of <code>X</code>.
If <code>1.0</code> or <code>TRUE</code>, then one future per worker is used.
If <code>2.0</code>, then each worker will process two futures
(if there are enough elements in <code>X</code>).
If <code>Inf</code> or <code>FALSE</code>, then one future per element of
<code>X</code> is used.
Only used if <code>future.chunk.size</code> is <code>NULL</code>.</p></dd>


<dt id="arg-future-chunk-size">future.chunk.size<a class="anchor" aria-label="anchor" href="#arg-future-chunk-size"></a></dt>
<dd><p>The average number of elements per future ("chunk").
If <code>Inf</code>, then all elements are processed in a single future.
If <code>NULL</code>, then argument <code>future.scheduling</code> is used.</p></dd>


<dt id="arg-n">n<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>The number of replicates.</p></dd>


<dt id="arg-expr">expr<a class="anchor" aria-label="anchor" href="#arg-expr"></a></dt>
<dd><p>An <span style="R">R</span> expression to evaluate repeatedly.</p></dd>


<dt id="arg-simplify">simplify<a class="anchor" aria-label="anchor" href="#arg-simplify"></a></dt>
<dd><p>See <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">base::sapply()</a></code> and <code><a href="https://rdrr.io/r/base/tapply.html" class="external-link">base::tapply()</a></code>, respectively.</p></dd>


<dt id="arg-index">INDEX<a class="anchor" aria-label="anchor" href="#arg-index"></a></dt>
<dd><p>A list of one or more factors, each of same length as <code>X</code>.
The elements are coerced to <code><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></code>s by
<code><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor()</a></code>. Can also be a formula, which
is useful if <code>X</code> is a data frame; see the <code>f</code> argument in
<code><a href="https://rdrr.io/r/base/split.html" class="external-link">split()</a></code> for interpretation.</p></dd>


<dt id="arg-default">default<a class="anchor" aria-label="anchor" href="#arg-default"></a></dt>
<dd><p>See <code><a href="https://rdrr.io/r/base/tapply.html" class="external-link">base::tapply()</a></code>.</p></dd>


<dt id="arg-fun-value">FUN.VALUE<a class="anchor" aria-label="anchor" href="#arg-fun-value"></a></dt>
<dd><p>A template for the required return value from
each <code>FUN(X[ii], ...)</code>.
Types may be promoted to a higher type within the ordering
logical &lt; integer &lt; double &lt; complex, but not demoted.
See <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">base::vapply()</a></code> for details.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>(optional) Additional arguments passed to <code>FUN()</code>.
For <code>future_*apply()</code> functions and <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate()</a></code>, any <code>future.*</code> arguments
part of <code>\ldots</code> are passed on to <code>future_lapply()</code> used internally.
Importantly, if this is called inside another function which also declares
... arguments, do not forget to explicitly pass such ... arguments
down to the <code>future_*apply()</code> function too, which will then pass them on
to <code>FUN()</code>. See below for an example.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A named (unless <code>USE.NAMES = FALSE</code>) list.
See <code><a href="https://rdrr.io/r/base/eapply.html" class="external-link">base::eapply()</a></code> for details.</p>
<p>For <code>future_lapply()</code>, a list with same length and names as <code>X</code>.
See <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">base::lapply()</a></code> for details.</p>
<p><code>future_replicate()</code> is a wrapper around <code>future_sapply()</code> and return
simplified object according to the <code>simplify</code> argument.
See <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">base::replicate()</a></code> for details.
Since <code>future_replicate()</code> usually involves random number generation (RNG),
it uses <code>future.seed = TRUE</code> by default in order produce sound random
numbers regardless of future backend and number of background workers used.</p>
<p>For <code>future_sapply()</code>, a vector with same length and names as <code>X</code>.
See <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">base::sapply()</a></code> for details.</p>
<p><code>future_tapply()</code> returns an array with mode <code>"list"</code>, unless
<code>simplify = TRUE</code> (default) <em>and</em> <code>FUN</code> returns a scalar, in which
case the mode of the array is the same as the returned scalars.
See <code><a href="https://rdrr.io/r/base/tapply.html" class="external-link">base::tapply()</a></code> for details.</p>
<p>For <code>future_vapply()</code>, a vector with same length and names as <code>X</code>.
See <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">base::vapply()</a></code> for details.</p>
    </div>
    <div class="section level2">
    <h2 id="global-variables">Global variables<a class="anchor" aria-label="anchor" href="#global-variables"></a></h2>


<p>Argument <code>future.globals</code> may be used to control how globals
should be handled similarly how the <code>globals</code> argument is used with
<code><a href="https://future.futureverse.org/reference/future.html" class="external-link">future()</a></code>.
Since all function calls use the same set of globals, this function can do
any gathering of globals upfront (once), which is more efficient than if
it would be done for each future independently.
If <code>TRUE</code> (default), then globals are automatically identified and gathered.
If a character vector of names is specified, then those globals are gathered.
If a named list, then those globals are used as is.
In all cases, <code>FUN</code> and any <code>\ldots</code> arguments are automatically
passed as globals to each future created as they are always needed.</p>
    </div>
    <div class="section level2">
    <h2 id="reproducible-random-number-generation-rng-">Reproducible random number generation (RNG)<a class="anchor" aria-label="anchor" href="#reproducible-random-number-generation-rng-"></a></h2>


<p>Unless <code>future.seed</code> is <code>FALSE</code> or <code>NULL</code>, this function guarantees to
generate the exact same sequence of random numbers <em>given the same initial
seed / RNG state</em> - this regardless of type of futures, scheduling
("chunking") strategy, and number of workers.</p>
<p>RNG reproducibility is achieved by pregenerating the random seeds for all
iterations (over <code>X</code>) by using parallel RNG streams.  In each
iteration, these seeds are set before calling <code>FUN(X[[ii]], ...)</code>.
<em>Note, for large <code>length(X)</code> this may introduce a large overhead.</em></p>
<p>If <code>future.seed = TRUE</code>, then <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">.Random.seed</a></code>
is used if it holds a parallel RNG seed, otherwise one is created
randomly.</p>
<p>If <code>future.seed = FALSE</code>, it is expected that none of the
<code>FUN(X[[ii]], ...)</code> function calls use random number generation.
If they do, then an informative warning or error is produces depending
on settings. See <a href="https://future.futureverse.org/reference/future.html" class="external-link">future::future</a> for more details.
Using <code>future.seed = NULL</code>, is like <code>future.seed = FALSE</code> but without
the check whether random numbers were generated or not.</p>
<p>As input, <code>future.seed</code> may also take a fixed initial seed (integer),
either as a full parallel RNG seed, or as a seed generating such a
full parallel seed. This seed will be used to generated <code>length(X)</code>
parallel RNG streams.</p>
<p>In addition to the above, it is possible to specify a pre-generated
sequence of RNG seeds as a list such that
<code>length(future.seed) == length(X)</code> and where each element is an
integer seed vector that can be assigned to
<code><a href="https://rdrr.io/r/base/Random.html" class="external-link">.Random.seed</a></code>.  One approach to generate a
set of valid RNG seeds based on fixed initial seed (here <code>42L</code>) is:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">seeds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/future_lapply.html">future_lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">.Random.seed</span>,</span>
<span>                       future.chunk.size <span class="op">=</span> <span class="cn">Inf</span>, future.seed <span class="op">=</span> <span class="fl">42L</span><span class="op">)</span></span></code></pre><p></p></div>
<p><strong>Note that <code>as.list(seq_along(X))</code> is <em>not</em> a valid set of such
<code>.Random.seed</code> values.</strong></p>
<p>In all cases but <code>future.seed = FALSE</code> and <code>NULL</code>, the RNG state of the
calling R processes after this function returns is guaranteed to be
"forwarded one step" from the RNG state that was before the call and
in the same way regardless of <code>future.seed</code>, <code>future.scheduling</code>
and future strategy used.  This is done in order to guarantee that an <span style="R">R</span>
script calling <code>future_lapply()</code> multiple times should be numerically
reproducible given the same initial seed.</p>
    </div>
    <div class="section level2">
    <h2 id="control-processing-order-of-elements">Control processing order of elements<a class="anchor" aria-label="anchor" href="#control-processing-order-of-elements"></a></h2>


<p>Attribute <code>ordering</code> of <code>future.chunk.size</code> or <code>future.scheduling</code> can
be used to control the ordering the elements are iterated over, which
only affects the processing order and <em>not</em> the order values are returned.
This attribute can take the following values:</p><ul><li><p>index vector - an numeric vector of length <code>length(X)</code></p></li>
<li><p>function     - an function taking one argument which is called as
<code>ordering(length(X))</code> and which must return an
index vector of length <code>length(X)</code>, e.g.
<code>function(n) rev(seq_len(n))</code> for reverse ordering.</p></li>
<li><p><code>"random"</code>   - this will randomize the ordering via random index
vector <code>sample.int(length(X))</code>.
For example, <code>future.scheduling = structure(TRUE, ordering = "random")</code>.
<em>Note</em>, when elements are processed out of order, then captured standard
output and conditions are also relayed in that order, that is out of order.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>The implementations of <code>future_replicate()</code>, <code>future_sapply()</code>, and
<code>future_tapply()</code> are adopted from the source code of the corresponding
base <span style="R">R</span> functions, which are licensed under GPL (&gt;= 2) with
'The R Core Team' as the copyright holder.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## ---------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## lapply(), sapply(), tapply()</span></span></span>
<span class="r-in"><span><span class="co">## ---------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, logic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">x</span>, FUN <span class="op">=</span> <span class="va">quantile</span>, probs <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y1</span> <span class="op">&lt;-</span> <span class="fu">future_lapply</span><span class="op">(</span><span class="va">x</span>, FUN <span class="op">=</span> <span class="va">quantile</span>, probs <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">y1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $a</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  25%  50%  75% </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3.25 5.50 7.75 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $beta</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       25%       50%       75% </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.2516074 1.0000000 5.0536690 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $logic</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25% 50% 75% </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.0 0.5 1.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">y1</span>, <span class="va">y0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">y0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x</span>, FUN <span class="op">=</span> <span class="va">quantile</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y1</span> <span class="op">&lt;-</span> <span class="fu">future_sapply</span><span class="op">(</span><span class="va">x</span>, FUN <span class="op">=</span> <span class="va">quantile</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">y1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          a        beta logic</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0%    1.00  0.04978707   0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25%   3.25  0.25160736   0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 50%   5.50  1.00000000   0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 75%   7.75  5.05366896   1.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 100% 10.00 20.08553692   1.0</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">y1</span>, <span class="va">y0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">y0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">x</span>, FUN <span class="op">=</span> <span class="va">quantile</span>, FUN.VALUE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">double</a></span><span class="op">(</span><span class="fl">5L</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y1</span> <span class="op">&lt;-</span> <span class="fu">future_vapply</span><span class="op">(</span><span class="va">x</span>, FUN <span class="op">=</span> <span class="va">quantile</span>, FUN.VALUE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">double</a></span><span class="op">(</span><span class="fl">5L</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">y1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          a        beta logic</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0%    1.00  0.04978707   0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25%   3.25  0.25160736   0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 50%   5.50  1.00000000   0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 75%   7.75  5.05366896   1.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 100% 10.00 20.08553692   1.0</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">y1</span>, <span class="va">y0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ---------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Parallel Random Number Generation</span></span></span>
<span class="r-in"><span><span class="co">## ---------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co">## Regardless of the future plan, the number of workers, and</span></span></span>
<span class="r-in"><span><span class="co">## where they are, the random numbers produced are identical</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0xBEEF</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y1</span> <span class="op">&lt;-</span> <span class="fu">future_lapply</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, FUN <span class="op">=</span> <span class="va">rnorm</span>, future.seed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">y1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ : num -1.32</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ : num [1:2] -1.5 0.293</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ : num [1:3] 2.787 0.929 -0.461</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ : num [1:4] -0.193 -0.184 0.504 1.255</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ : num [1:5] -1.704 1.142 2.352 -1.474 -0.559</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">sequential</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0xBEEF</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y2</span> <span class="op">&lt;-</span> <span class="fu">future_lapply</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, FUN <span class="op">=</span> <span class="va">rnorm</span>, future.seed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">y2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ : num -1.32</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ : num [1:2] -1.5 0.293</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ : num [1:3] 2.787 0.929 -0.461</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ : num [1:4] -0.193 -0.184 0.504 1.255</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ : num [1:5] -1.704 1.142 2.352 -1.474 -0.559</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">y1</span>, <span class="va">y2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ---------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Process chunks of data.frame rows in parallel</span></span></span>
<span class="r-in"><span><span class="co">## ---------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="va">iris</span> <span class="op">&lt;-</span> <span class="fu">datasets</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/datasets/iris.html" class="external-link">iris</a></span></span></span>
<span class="r-in"><span><span class="va">chunks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">iris</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">3L</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">chunks</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">iris</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">sum</span>, <span class="va">y0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y1</span> <span class="op">&lt;-</span> <span class="fu">future_lapply</span><span class="op">(</span><span class="va">chunks</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">iris</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">sum</span>, <span class="va">y1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">y1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 876.5</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">y1</span>, <span class="va">y0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ---------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Remember to pass down '...' arguments</span></span></span>
<span class="r-in"><span><span class="co">## ---------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## It is important that we don't use '...' as a global variable,</span></span></span>
<span class="r-in"><span><span class="co">## as attempted in the following not_okay_fcn()</span></span></span>
<span class="r-in"><span><span class="va">bad_fcn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">future_lapply</span><span class="op">(</span><span class="va">X</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span>  <span class="co">## here '...' is a global variable</span></span></span>
<span class="r-in"><span>  <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">y</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Instead, make sure to pass '...' via arguments all the way through</span></span></span>
<span class="r-in"><span><span class="va">good_fcn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span> <span class="co">## outer '...'</span></span></span>
<span class="r-in"><span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">future_lapply</span><span class="op">(</span><span class="va">X</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span>  <span class="co">## here '...' is an argument of FUN()</span></span></span>
<span class="r-in"><span>  <span class="op">}</span>, <span class="va">...</span><span class="op">)</span> <span class="co">## pass outer '...' to FUN()</span></span></span>
<span class="r-in"><span>  <span class="va">y</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Henrik Bengtsson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1</p> and <a href="https://github.com/HenrikBengtsson/pkgdown.extras/">pkgdown.extras</a> 0.0.0.9007.</p>
</div>

    </footer></div>





  </body></html>

